<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Citas del Día</title>

<link rel="stylesheet" href="/static/css/sanacion.css">

<style>
body {
    display: block !important;
    padding: 20px;
    font-family: Arial, sans-serif;
    background: #f7f7f7;
}

h2 { 
    text-align: center; 
    color: #007bff; 
    margin: 0;         /* quita todos los márgenes */
    margin-bottom: 10px; /* espacio mínimo debajo del título */
}

.contenedor {
    max-width: 1000px;
    margin: 0 auto;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.08);
}

.filtro-barra {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin: 20px 0;
    padding: 12px 20px;
    background: #f8f9fa;
    border-radius: 10px;
    max-width: 420px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

.filtro-barra select {
    padding: 8px 12px;
    font-size: 1em;
    border-radius: 6px;
    border: 1px solid #ccc;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    font-size: 1.1em;
}

th, td {
    border: 1px solid #ddd;
    padding: 12px;
    text-align: left;
}

th {
    background: #007bff;
    color: white;
}

tr:nth-child(even) { background: #f2f2f2; }

.btn-volver {
    display: block;
    width: 100%;
    max-width: 300px;
    margin: 30px auto 0 auto;
    padding: 14px;
    background: #007bff;
    color: white;
    border-radius: 8px;
    text-align: center;
    text-decoration: none;
    font-size: 1.1em;
}

.no-citas {
    text-align:center; 
    font-size:1.2em; 
    margin-top:20px;
}

.botones-dia {
    display: flex;
    justify-content: center;  /* centra los botones horizontalmente */
    gap: 10px;               /* espacio entre ellos */
    margin: 20px 0;          /* opcional, separa del contenido */
    margin-top: 5px; /* separa un poco del título */
}

.botones-dia button {
    padding: 10px 15px;
    font-size: 1em;
    border-radius: 6px;
    border: none;
    background: #007bff;
    color: white;
    cursor: pointer;
}

.botones-dia button:hover {
    background: #0056b3;
}
.fila-cita {
    background-color: var(--row-color);
}


</style>
</head>
<body>

<div class="contenedor">

    <h2>Citas del día {{ fecha }}</h2>

    <!-- Navegación de días -->
    <div style="text-align:center; margin-bottom:10px;">
        <form id="cambiarDiaForm" method="GET" style="display:inline-block;">
            <input type="hidden" name="fecha" id="fechaInput" value="{{ fecha }}">
            <input type="hidden" name="terapeuta" value="{{ terapeuta_sel }}">
        </form>
    </div>
    <div class="botones-dia">
        <button type="button" onclick="cambiarDia(-1)">Día anterior</button>
        <button type="button" onclick="cambiarDia(1)">Día siguiente</button>
    </div>


    <!-- Barra de filtro por terapeuta -->
    <div class="filtro-barra">
        
        <select id="filtroTerapeuta" onchange="filtrarTerapeuta()">
            {% for t in terapeutas %}
                <option value="{{ t.Usuario }}" {% if t.Usuario == usuario_logueado %}selected{% endif %}>
                    {{ t.NombreUsuario }}
                </option>
            {% endfor %}
        </select>
    </div>

    {% if citas %}
        <table>
            <thead>
                <tr>
                    <th>Hora</th>
                    <th>Paciente</th>
                    <th>Estatus</th>
                </tr>
            </thead>
            <tbody>
                {% for c in citas %}
                    <tr style="--row-color: {{ c.color }};" class="fila-cita" data-terapeuta="{{ c.Terapeuta }}">

                        <td>{{ c.HoraCita }}</td>
                        <td>
                            {% if c.idPaciente %}
                                {{ c.NombrePaciente }}
                            {% else %}
                                <em>Disponible</em>
                            {% endif %}
                        </td>
                        <td>{{ c.idEstatus }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="no-citas">No hay citas en este día.</p>
    {% endif %}

    <a href="/admin/ver_citas" class="btn-volver">← Volver al calendario</a>

</div>

<script>
// Filtro por terapeuta
function filtrarTerapeuta() {
    const seleccionado = document.getElementById("filtroTerapeuta").value;
    const filas = document.querySelectorAll("tbody tr");

    filas.forEach(fila => {
        fila.style.display =
            fila.dataset.terapeuta === seleccionado
            ? ""
            : "none";
    });
}

// Aplicar filtro al cargar
document.addEventListener("DOMContentLoaded", filtrarTerapeuta);

// Cambiar día
function cambiarDia(delta) {
    const input = document.getElementById("fechaInput");
    const parts = input.value.split('-'); // ["YYYY","MM","DD"]
    // Crear fecha en zona local
    const fechaActual = new Date(parts[0], parts[1] - 1, parts[2]);
    
    fechaActual.setDate(fechaActual.getDate() + delta);

    const yyyy = fechaActual.getFullYear();
    const mm = String(fechaActual.getMonth() + 1).padStart(2, '0');
    const dd = String(fechaActual.getDate()).padStart(2, '0');

    input.value = `${yyyy}-${mm}-${dd}`;
    document.getElementById("cambiarDiaForm").submit();
}

</script>

</body>
</html>
