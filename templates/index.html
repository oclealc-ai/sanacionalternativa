<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanación Alternativa</title>
    <link rel="stylesheet" href="/static/css/index-minimal.css">
</head>
<body>
    <div class="container-minimal">
        <!-- Bloque de Frase -->
        <div class="frase-block" id="bloqueInfo">
            {{ frase }}
        </div>

        <!-- Carrusel de Anuncios -->
        <div class="carousel-wrapper">
            <div class="carousel-container">
                <div class="carousel-track" id="carouselTrack">
                    <!-- Slides generados por JS -->
                </div>
                <div class="carousel-description" id="carouselDescription"></div>
            </div>
        </div>

        <!-- Panel de Acceso -->
        <div class="access-panel">
            <h1>Sanación Alternativa</h1>
            <p class="subtitle">¿Cuál es tu rol?</p>
            
            <div class="button-group">
                <button class="btn-access btn-paciente" onclick="location.href='/login/paciente?empresa=1'">
                    <span class="btn-label">Soy Paciente</span>
                </button>
                <button class="btn-access btn-personal" onclick="location.href='/login/sistema'">
                    <span class="btn-label">Soy Personal</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Cargar anuncios desde la API (preparado para BD)
        // Endpoint esperado: /api/anuncios o similar
        async function loadAnuncios() {
            try {
                // TODO: Reemplazar con endpoint real de la API
                // const response = await fetch('/api/anuncios');
                // const anuncios = await response.json();
                
                // Por ahora, usar datos de demostración
                const anuncios = [
                    {
                        img: "/static/anuncios/imagen01.jpg",
                        url: "https://ejemplo.com/1",
                        descripcion: "Terapias holísticas personalizadas",
                        activo: true
                    },
                    {
                        img: "/static/anuncios/imagen02.jpg",
                        url: "https://ejemplo.com/2",
                        descripcion: "Agenda tu cita en línea",
                        activo: true
                    },
                    {
                        img: "/static/anuncios/imagen03.jpg",
                        url: "https://ejemplo.com/3",
                        descripcion: "Promociones especiales del mes",
                        activo: true
                    },
                    {
                        img: "/static/anuncios/imagen04.jpg",
                        url: "https://ejemplo.com/4",
                        descripcion: "Terapias holísticas personalizadas",
                        activo: true
                    },
                    {
                        img: "/static/anuncios/imagen05.jpg",
                        url: "https://ejemplo.com/5",
                        descripcion: "Agenda tu cita en línea",
                        activo: true
                    },
                    {
                        img: "/static/anuncios/imagen07.jpg",
                        url: "https://ejemplo.com/7",
                        descripcion: "Agenda tu cita en línea",
                        activo: true
                    }
                ];

                initCarousel(anuncios);
            } catch (error) {
                console.error("Error al cargar anuncios:", error);
            }
        }

        function initCarousel(anunciosData) {
            const activos = anunciosData.filter(a => a.activo);
            const track = document.getElementById("carouselTrack");
            const desc = document.getElementById("carouselDescription");
            const container = document.querySelector(".carousel-container");

            // Duplicamos anuncios (clave del infinito)
            const renderList = [...activos, ...activos];

            renderList.forEach((a) => {
                const item = document.createElement("div");
                item.className = "carousel-item";
                item.onclick = () => window.location.href = a.url;
                item.dataset.desc = a.descripcion;
                item.innerHTML = `<img src="${a.img}" alt="anuncio">`;
                track.appendChild(item);
            });

            let position = 0;
            let paused = false;
            const speed = 0.4;
            const itemWidth = 280;
            const resetPoint = itemWidth * activos.length;

            function animate() {
                if (!paused) {
                    position += speed;

                    if (position >= resetPoint) {
                        position -= resetPoint;
                    }

                    track.style.transform = `translateX(-${position}px)`;
                }

                requestAnimationFrame(animate);
            }

            // Hover: pausa + descripción
            container.addEventListener("mouseenter", (e) => {
                paused = true;

                const rect = container.getBoundingClientRect();
                const style = getComputedStyle(container);
                const paddingLeft = parseFloat(style.paddingLeft);

                const x = e.clientX - rect.left - paddingLeft;
                const index = Math.floor((position + x) / itemWidth) % activos.length;

                desc.innerText = activos[index].descripcion;
                desc.style.opacity = "1";
            });

            container.addEventListener("mousemove", (e) => {
                if (!paused) return;

                const rect = container.getBoundingClientRect();
                const style = getComputedStyle(container);
                const paddingLeft = parseFloat(style.paddingLeft);

                const x = e.clientX - rect.left - paddingLeft;
                const index = Math.floor((position + x) / itemWidth) % activos.length;

                desc.innerText = activos[index].descripcion;
            });

            container.addEventListener("mouseleave", () => {
                paused = false;
                desc.style.opacity = "0";
            });

            animate();
        }

        // Inicializar al cargar la página
        document.addEventListener("DOMContentLoaded", loadAnuncios);
    </script>

</body>
</html>
